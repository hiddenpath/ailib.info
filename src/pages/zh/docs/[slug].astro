---
import { getCollection } from 'astro:content';
import DocsLayout from '../../../layouts/DocsLayout.astro';

// Generate canonical zh paths + simple fallback (slug + 'zh') redirect.
export async function getStaticPaths() {
  const zhDocs = await getCollection('docs', ({ id }) => id.includes('.zh.'));
  return zhDocs.map(entry => {
    const base = entry.slug.replace(/zh$/, ''); // canonical without trailing zh
    return { params: { slug: base }, props: { targetSlug: entry.slug } };
  });
}

// Props
// @ts-ignore
const { targetSlug } = Astro.props;
const docs = await getCollection('docs');
// Find exact zh entry by original slug, fallback: slug + 'zh'
let entry = docs.find(d => d.slug === targetSlug);
if (!entry) {
  entry = docs.find(d => d.slug === `${targetSlug}zh`);
}
if (!entry) {
  return Astro.redirect('/zh/docs/intro');
}
const { Content } = await entry.render();
---

<DocsLayout docTitle={entry.data.title} frontmatter={entry.data} url={Astro.url}>
  <Content />
</DocsLayout>
