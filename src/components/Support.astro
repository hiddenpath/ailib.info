---
const { locale = 'en' } = Astro.props;
const isZh = locale === 'zh';
---

<section id="contact">
  <h2>{isZh ? '商业与支持' : 'Commercial & Support'}</h2>
  <p class="dim" style="max-width:760px;">
    {
      isZh ? (
        <>当前阶段：征集早期使用反馈与企业级需求。欢迎联系我们获取演示与合作方案。</>
      ) : (
        <>We welcome enterprise inquiries for demos and engagements. Click below to contact us.</>
      )
    }
  </p>

  <button class="contact-link" type="button">
    {isZh ? '联系团队' : 'Contact the Team'}
  </button>

  <div id="contact-modal" class="modal" aria-hidden="true">
    <button class="modal-backdrop" aria-hidden="true" onclick="closeContactModal()"></button>
    <div class="modal-dialog" role="dialog" aria-modal="true" aria-labelledby="contact-title" onclick="event.stopPropagation()">
      <button class="modal-close" aria-label="Close" onclick="closeContactModal()">×</button>
      <h3 id="contact-title">{isZh ? '联系 ai-lib 团队' : 'Contact ai-lib Team'}</h3>
      <p class="dim">
        {isZh
          ? '请填写以下信息，我们通常 2–3 个工作日内回复。'
          : 'Please fill in the information below. We usually respond within 2–3 business days.'}
      </p>
      <form method="POST" action="https://formsubmit.co/walex_98@msn.com">
        <input type="hidden" name="_subject" value="ai-lib Website Contact" />
        <input type="hidden" name="_captcha" value="false" />
        <input type="hidden" name="_template" value="table" />
        <div class="row">
          <div class="col">
            <label>{isZh ? '姓名' : 'Name'}</label>
            <input required name="name" placeholder={isZh ? '姓名' : 'Your name'} />
          </div>
          <div class="col">
            <label>Email</label>
            <input required type="email" name="email" placeholder="you@company.com" />
          </div>
        </div>
        <div class="row">
          <div class="col">
            <label>{isZh ? '公司 / 组织' : 'Company / Org'}</label>
            <input name="company" placeholder="Acme Corp" />
          </div>
          <div class="col">
            <label>{isZh ? '预计用例' : 'Intended Use Case'}</label>
            <input name="use_case" placeholder={isZh ? '路由/成本/推理等' : 'Routing/Cost/Reasoning'} />
          </div>
        </div>
        <div class="row">
          <div class="col full">
            <label>{isZh ? '需求与时间表' : 'Needs & Timeline'}</label>
            <textarea name="details" rows="4" placeholder={isZh ? 'Q4 上线，需可靠性策略...' : 'Prod in Q4, need reliability strategy...'}></textarea>
          </div>
        </div>
        <div class="actions">
          <button class="button" type="submit">{isZh ? '发送' : 'Send'}</button>
        </div>
      </form>
    </div>
  </div>
</section>

<script>
  (function(){
    function open() {
      const m = document.getElementById('contact-modal');
      if (!m) { location.hash = 'contact'; return; }
      m.setAttribute('aria-hidden', 'false');
      document.body.style.overflow = 'hidden';
      const first = m.querySelector('input, textarea, button');
      if (first) setTimeout(()=> first.focus(), 30);
    }
    function close() {
      const m = document.getElementById('contact-modal');
      if (!m) return;
      m.setAttribute('aria-hidden', 'true');
      document.body.style.overflow = '';
    }
    window.openContactModal = open;
    window.closeContactModal = close;

    document.addEventListener('keydown', (e)=> {
      if (e.key === 'Escape') {
        const m = document.getElementById('contact-modal');
        if (m && m.getAttribute('aria-hidden') === 'false') close();
      }
    });

    if (location.hash === '#contact') {
      requestAnimationFrame(()=> open());
    }

    document.addEventListener('click', (e) => {
      const target = e.target instanceof Element ? e.target : null;
      const a = target ? target.closest('a') : null;
      if (!a) return;
      const href = a.getAttribute('href') || '';
      if (href.endsWith('#contact') || href === '#contact') {
        e.preventDefault();
        const section = document.getElementById('contact');
        if (section) section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        setTimeout(()=> open(), 120);
      }
    }, { passive: false });

    // Fallback: ensure button works even if inline onclick executes before script load
    const btn = document.querySelector('.contact-link');
    if (btn) btn.addEventListener('click', (e)=> { e.preventDefault(); open(); });
  })();
 </script>

<style>
  .contact-link {
    margin-top: 12px;
    padding: 10px 14px;
    border-radius: 8px;
    border: 1px solid var(--border);
    background: linear-gradient(180deg, var(--bg) 0%, var(--bg-alt) 100%);
    color: var(--text);
    cursor: pointer;
    transition: all .2s ease;
  }
  .contact-link:hover { box-shadow: 0 6px 18px rgba(0,0,0,.12); transform: translateY(-1px); }

  .modal[aria-hidden="true"] { display: none; }
  .modal { position: fixed; inset: 0; z-index: 200; display: grid; place-items: center; }
  .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.35); border: 0; z-index: 0; }
  .modal-dialog {
    position: relative;
    width: min(680px, calc(100% - 28px));
    border-radius: 16px;
    border: 1px solid var(--border);
    background: var(--bg);
    padding: 22px 22px 18px;
    box-shadow: 0 16px 48px rgba(0,0,0,.35);
    animation: modalIn .18s ease-out;
    z-index: 1;
  }
  @keyframes modalIn { from { transform: translateY(8px); opacity: .85 } to { transform: translateY(0); opacity: 1 } }
  .modal-close { position: absolute; top: 10px; right: 12px; border: 0; background: transparent; font-size: 20px; color: var(--text-dim); cursor: pointer; }
  .modal-close:hover { color: var(--text); }
  .row { display: flex; gap: 12px; margin-top: 10px; }
  .col { flex: 1; min-width: 220px; display: flex; flex-direction: column; gap: 6px; }
  .col.full { min-width: 100%; }
  label { font-size: 12px; color: var(--text-dim); }
  input, textarea { border: 1px solid var(--border); border-radius: 8px; padding: 10px 12px; background: var(--bg-alt); color: var(--text); }
  input:focus, textarea:focus { outline: none; border-color: var(--accent); box-shadow: 0 0 0 2px rgba(93,139,255,.15); }
  .actions { display: flex; justify-content: flex-end; margin-top: 14px; }
</style>
