---
const { locale = 'en' } = Astro.props;
const isZh = locale === 'zh' || locale === 'zh-cn';
---

<div class="w-full overflow-x-auto">
  <svg viewBox="0 0 1100 620" xmlns="http://www.w3.org/2000/svg" class="w-full max-w-5xl mx-auto" style="min-width: 800px;">
    <defs>
      <linearGradient id="grad-protocol" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#8b5cf6;stop-opacity:0.9" />
        <stop offset="100%" style="stop-color:#a78bfa;stop-opacity:0.9" />
      </linearGradient>
      <linearGradient id="grad-rust" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#f97316;stop-opacity:0.9" />
        <stop offset="100%" style="stop-color:#fb923c;stop-opacity:0.9" />
      </linearGradient>
      <linearGradient id="grad-python" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.9" />
        <stop offset="100%" style="stop-color:#34d399;stop-opacity:0.9" />
      </linearGradient>
      <linearGradient id="grad-typescript" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.9" />
        <stop offset="100%" style="stop-color:#60a5fa;stop-opacity:0.9" />
      </linearGradient>
      <linearGradient id="grad-mock" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#6b7280;stop-opacity:0.9" />
        <stop offset="100%" style="stop-color:#9ca3af;stop-opacity:0.9" />
      </linearGradient>
      <linearGradient id="grad-app" x1="0%" y1="0%" x2="100%" y2="100%">
        <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.9" />
        <stop offset="100%" style="stop-color:#60a5fa;stop-opacity:0.9" />
      </linearGradient>
      <filter id="shadow">
        <feDropShadow dx="0" dy="2" stdDeviation="4" flood-color="rgba(0,0,0,0.3)" />
      </filter>
      <marker id="arrow" viewBox="0 0 10 7" refX="10" refY="3.5" markerWidth="8" markerHeight="6" orient="auto-start-reverse">
        <path d="M 0 0 L 10 3.5 L 0 7 z" fill="#64748b" />
      </marker>
    </defs>

    <!-- Background -->
    <rect width="1100" height="620" rx="16" fill="#0f172a" opacity="0.5" />

    <!-- Title -->
    <text x="550" y="38" text-anchor="middle" fill="#e2e8f0" font-size="16" font-weight="700" font-family="Inter, system-ui, sans-serif">
      {isZh ? 'AI-Lib 生态系统架构' : 'AI-Lib Ecosystem Architecture'}
    </text>

    <!-- Layer Labels -->
    <text x="30" y="90" fill="#64748b" font-size="10" font-weight="600" font-family="Inter, system-ui, sans-serif" text-anchor="start" transform="rotate(-90, 30, 130)">
      {isZh ? '应用层' : 'APPLICATION'}
    </text>
    <text x="30" y="248" fill="#64748b" font-size="10" font-weight="600" font-family="Inter, system-ui, sans-serif" text-anchor="start" transform="rotate(-90, 30, 300)">
      {isZh ? '运行时层' : 'RUNTIME'}
    </text>
    <text x="30" y="440" fill="#64748b" font-size="10" font-weight="600" font-family="Inter, system-ui, sans-serif" text-anchor="start" transform="rotate(-90, 30, 480)">
      {isZh ? '协议层' : 'PROTOCOL'}
    </text>

    <!-- Layer separators -->
    <line x1="60" y1="160" x2="1040" y2="160" stroke="#334155" stroke-width="1" stroke-dasharray="6,4" />
    <line x1="60" y1="350" x2="1040" y2="350" stroke="#334155" stroke-width="1" stroke-dasharray="6,4" />

    <!-- Application Layer -->
    <g filter="url(#shadow)">
      <rect x="100" y="65" width="180" height="75" rx="10" fill="#1e293b" stroke="#3b82f6" stroke-width="1.5" />
      <text x="190" y="95" text-anchor="middle" fill="#93c5fd" font-size="11" font-weight="600" font-family="Inter, system-ui, sans-serif">{isZh ? 'Web 应用 / API 服务' : 'Web Apps / API Services'}</text>
      <text x="190" y="115" text-anchor="middle" fill="#64748b" font-size="10" font-family="Inter, system-ui, sans-serif">Rust / Python / TS</text>
      <text x="190" y="130" text-anchor="middle" fill="#475569" font-size="9" font-family="Inter, system-ui, sans-serif">{isZh ? '你的应用代码' : 'Your application code'}</text>
    </g>
    <g filter="url(#shadow)">
      <rect x="320" y="65" width="180" height="75" rx="10" fill="#1e293b" stroke="#3b82f6" stroke-width="1.5" />
      <text x="410" y="95" text-anchor="middle" fill="#93c5fd" font-size="11" font-weight="600" font-family="Inter, system-ui, sans-serif">{isZh ? 'AI 智能体' : 'AI Agents'}</text>
      <text x="410" y="115" text-anchor="middle" fill="#64748b" font-size="10" font-family="Inter, system-ui, sans-serif">{isZh ? '多轮对话 / 工具调用' : 'Multi-turn / Tool Calling'}</text>
    </g>
    <g filter="url(#shadow)">
      <rect x="540" y="65" width="180" height="75" rx="10" fill="#1e293b" stroke="#3b82f6" stroke-width="1.5" />
      <text x="630" y="95" text-anchor="middle" fill="#93c5fd" font-size="11" font-weight="600" font-family="Inter, system-ui, sans-serif">{isZh ? 'CLI 工具' : 'CLI Tools'}</text>
      <text x="630" y="115" text-anchor="middle" fill="#64748b" font-size="10" font-family="Inter, system-ui, sans-serif">{isZh ? '批处理 / 数据管道' : 'Batch / Data Pipelines'}</text>
    </g>
    <g filter="url(#shadow)">
      <rect x="760" y="65" width="180" height="75" rx="10" fill="#1e293b" stroke="#3b82f6" stroke-width="1.5" />
      <text x="850" y="95" text-anchor="middle" fill="#93c5fd" font-size="11" font-weight="600" font-family="Inter, system-ui, sans-serif">{isZh ? '测试与开发' : 'Testing & Dev'}</text>
      <text x="850" y="115" text-anchor="middle" fill="#64748b" font-size="10" font-family="Inter, system-ui, sans-serif">{isZh ? 'Mock 服务' : 'Mock Services'}</text>
    </g>

    <!-- Arrows from App to Runtime -->
    <!-- Universal App-to-Runtime Bus -->
    <path d="M 190 140 L 190 165 M 410 140 L 410 165 M 630 140 L 630 165 M 850 140 L 850 165 M 190 165 L 850 165" fill="none" stroke="#64748b" stroke-width="1.5" stroke-linejoin="round" />
    <line x1="235" y1="165" x2="235" y2="195" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)" />
    <line x1="565" y1="165" x2="565" y2="195" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)" />
    <line x1="795" y1="165" x2="795" y2="195" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)" />

    <!-- Runtime Layer: Rust -->
    <g filter="url(#shadow)">
      <rect x="80" y="195" width="310" height="135" rx="12" fill="#1e293b" stroke="#f97316" stroke-width="2" />
      <rect x="80" y="195" width="310" height="32" rx="12" fill="url(#grad-rust)" />
      <rect x="80" y="215" width="310" height="12" fill="url(#grad-rust)" />
      <text x="235" y="216" text-anchor="middle" fill="white" font-size="13" font-weight="700" font-family="Inter, system-ui, sans-serif">ai-lib-rust v0.8.5</text>

      <!-- Internal modules -->
      <rect x="95" y="238" width="85" height="28" rx="4" fill="#f97316" opacity="0.1" stroke="#f97316" stroke-width="0.5" />
      <text x="137" y="256" text-anchor="middle" fill="#fb923c" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">AiClient</text>

      <rect x="190" y="238" width="85" height="28" rx="4" fill="#f97316" opacity="0.1" stroke="#f97316" stroke-width="0.5" />
      <text x="232" y="256" text-anchor="middle" fill="#fb923c" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Pipeline</text>

      <rect x="285" y="238" width="90" height="28" rx="4" fill="#f97316" opacity="0.1" stroke="#f97316" stroke-width="0.5" />
      <text x="330" y="256" text-anchor="middle" fill="#fb923c" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Transport</text>

      <rect x="95" y="274" width="85" height="28" rx="4" fill="#f97316" opacity="0.1" stroke="#f97316" stroke-width="0.5" />
      <text x="137" y="292" text-anchor="middle" fill="#fb923c" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Resilience</text>

      <rect x="190" y="274" width="85" height="28" rx="4" fill="#f97316" opacity="0.1" stroke="#f97316" stroke-width="0.5" />
      <text x="232" y="292" text-anchor="middle" fill="#fb923c" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Embeddings</text>

      <rect x="285" y="274" width="90" height="28" rx="4" fill="#f97316" opacity="0.1" stroke="#f97316" stroke-width="0.5" />
      <text x="330" y="292" text-anchor="middle" fill="#fb923c" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Cache / Batch</text>

      <text x="235" y="318" text-anchor="middle" fill="#64748b" font-size="9" font-family="Inter, system-ui, sans-serif">Crates.io · tokio + reqwest · &lt;1ms overhead</text>
    </g>

    <!-- Runtime Layer: Python -->
    <g filter="url(#shadow)">
      <rect x="410" y="195" width="310" height="135" rx="12" fill="#1e293b" stroke="#10b981" stroke-width="2" />
      <rect x="410" y="195" width="310" height="32" rx="12" fill="url(#grad-python)" />
      <rect x="410" y="215" width="310" height="12" fill="url(#grad-python)" />
      <text x="565" y="216" text-anchor="middle" fill="white" font-size="13" font-weight="700" font-family="Inter, system-ui, sans-serif">ai-lib-python v0.7.4</text>

      <!-- Internal modules -->
      <rect x="425" y="238" width="85" height="28" rx="4" fill="#10b981" opacity="0.1" stroke="#10b981" stroke-width="0.5" />
      <text x="467" y="256" text-anchor="middle" fill="#34d399" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">AiClient</text>

      <rect x="520" y="238" width="85" height="28" rx="4" fill="#10b981" opacity="0.1" stroke="#10b981" stroke-width="0.5" />
      <text x="562" y="256" text-anchor="middle" fill="#34d399" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Pipeline</text>

      <rect x="615" y="238" width="90" height="28" rx="4" fill="#10b981" opacity="0.1" stroke="#10b981" stroke-width="0.5" />
      <text x="660" y="256" text-anchor="middle" fill="#34d399" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Transport</text>

      <rect x="425" y="274" width="85" height="28" rx="4" fill="#10b981" opacity="0.1" stroke="#10b981" stroke-width="0.5" />
      <text x="467" y="292" text-anchor="middle" fill="#34d399" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Resilience</text>

      <rect x="520" y="274" width="85" height="28" rx="4" fill="#10b981" opacity="0.1" stroke="#10b981" stroke-width="0.5" />
      <text x="562" y="292" text-anchor="middle" fill="#34d399" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Telemetry</text>

      <rect x="615" y="274" width="90" height="28" rx="4" fill="#10b981" opacity="0.1" stroke="#10b981" stroke-width="0.5" />
      <text x="660" y="292" text-anchor="middle" fill="#34d399" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Routing</text>

      <text x="565" y="318" text-anchor="middle" fill="#64748b" font-size="9" font-family="Inter, system-ui, sans-serif">PyPI · httpx + Pydantic v2 · async/await</text>
    </g>

    <!-- Runtime Layer: TypeScript -->
    <g filter="url(#shadow)">
      <rect x="740" y="195" width="310" height="135" rx="12" fill="#1e293b" stroke="#3b82f6" stroke-width="2" />
      <rect x="740" y="195" width="310" height="32" rx="12" fill="url(#grad-typescript)" />
      <rect x="740" y="215" width="310" height="12" fill="url(#grad-typescript)" />
      <text x="895" y="216" text-anchor="middle" fill="white" font-size="13" font-weight="700" font-family="Inter, system-ui, sans-serif">ai-lib-ts v0.4.0</text>

      <!-- Internal modules -->
      <rect x="755" y="238" width="85" height="28" rx="4" fill="#3b82f6" opacity="0.1" stroke="#3b82f6" stroke-width="0.5" />
      <text x="797" y="256" text-anchor="middle" fill="#60a5fa" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">AiClient</text>

      <rect x="850" y="238" width="85" height="28" rx="4" fill="#3b82f6" opacity="0.1" stroke="#3b82f6" stroke-width="0.5" />
      <text x="892" y="256" text-anchor="middle" fill="#60a5fa" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Pipeline</text>

      <rect x="945" y="238" width="90" height="28" rx="4" fill="#3b82f6" opacity="0.1" stroke="#3b82f6" stroke-width="0.5" />
      <text x="990" y="256" text-anchor="middle" fill="#60a5fa" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Transport</text>

      <rect x="755" y="274" width="85" height="28" rx="4" fill="#3b82f6" opacity="0.1" stroke="#3b82f6" stroke-width="0.5" />
      <text x="797" y="292" text-anchor="middle" fill="#60a5fa" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Resilience</text>

      <rect x="850" y="274" width="85" height="28" rx="4" fill="#3b82f6" opacity="0.1" stroke="#3b82f6" stroke-width="0.5" />
      <text x="892" y="292" text-anchor="middle" fill="#60a5fa" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">MCP Bridge</text>

      <rect x="945" y="274" width="90" height="28" rx="4" fill="#3b82f6" opacity="0.1" stroke="#3b82f6" stroke-width="0.5" />
      <text x="990" y="292" text-anchor="middle" fill="#60a5fa" font-size="9" font-weight="500" font-family="Inter, system-ui, sans-serif">Batch</text>

      <text x="895" y="318" text-anchor="middle" fill="#64748b" font-size="9" font-family="Inter, system-ui, sans-serif">NPM · fetch + Zod · ESM / CJS</text>
    </g>

    <!-- Arrows from Runtime to Protocol -->
    <line x1="235" y1="330" x2="350" y2="375" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)" />
    <line x1="565" y1="330" x2="500" y2="375" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)" />
    <line x1="895" y1="330" x2="650" y2="375" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)" />
    <text x="450" y="360" text-anchor="middle" fill="#475569" font-size="9" font-family="Inter, system-ui, sans-serif">{isZh ? '加载协议清单' : 'Load Manifests'}</text>

    <!-- Protocol Layer -->
    <g filter="url(#shadow)">
      <rect x="180" y="375" width="560" height="130" rx="12" fill="#1e293b" stroke="#8b5cf6" stroke-width="2" />
      <rect x="180" y="375" width="560" height="32" rx="12" fill="url(#grad-protocol)" />
      <rect x="180" y="395" width="560" height="12" fill="url(#grad-protocol)" />
      <text x="460" y="396" text-anchor="middle" fill="white" font-size="13" font-weight="700" font-family="Inter, system-ui, sans-serif">AI-Protocol v0.7.6</text>

      <!-- Internal modules -->
      <rect x="198" y="418" width="120" height="35" rx="6" fill="#8b5cf6" opacity="0.1" stroke="#8b5cf6" stroke-width="0.5" />
      <text x="258" y="432" text-anchor="middle" fill="#a78bfa" font-size="10" font-weight="600" font-family="Inter, system-ui, sans-serif">spec.yaml</text>
      <text x="258" y="446" text-anchor="middle" fill="#64748b" font-size="8" font-family="Inter, system-ui, sans-serif">{isZh ? '核心规范' : 'Core Specification'}</text>

      <rect x="330" y="418" width="150" height="35" rx="6" fill="#8b5cf6" opacity="0.1" stroke="#8b5cf6" stroke-width="0.5" />
      <text x="405" y="432" text-anchor="middle" fill="#a78bfa" font-size="10" font-weight="600" font-family="Inter, system-ui, sans-serif">providers/*.yaml</text>
      <text x="405" y="446" text-anchor="middle" fill="#64748b" font-size="8" font-family="Inter, system-ui, sans-serif">{isZh ? '37 个服务商清单' : '37 Provider Manifests'}</text>

      <rect x="492" y="418" width="120" height="35" rx="6" fill="#8b5cf6" opacity="0.1" stroke="#8b5cf6" stroke-width="0.5" />
      <text x="552" y="432" text-anchor="middle" fill="#a78bfa" font-size="10" font-weight="600" font-family="Inter, system-ui, sans-serif">models/*.yaml</text>
      <text x="552" y="446" text-anchor="middle" fill="#64748b" font-size="8" font-family="Inter, system-ui, sans-serif">{isZh ? '模型注册表' : 'Model Registry'}</text>

      <text x="460" y="490" text-anchor="middle" fill="#64748b" font-size="9" font-family="Inter, system-ui, sans-serif">{isZh ? 'YAML 定义 → JSON 编译 → 运行时消费 · 无供应商锁定' : 'YAML definitions → JSON compilation → Runtime consumption · Vendor neutral'}</text>
    </g>

    <!-- Mock Project -->
    <g filter="url(#shadow)">
      <rect x="770" y="375" width="280" height="130" rx="12" fill="#1e293b" stroke="#6b7280" stroke-width="2" />
      <rect x="770" y="375" width="280" height="32" rx="12" fill="url(#grad-mock)" />
      <rect x="770" y="395" width="280" height="12" fill="url(#grad-mock)" />
      <text x="910" y="396" text-anchor="middle" fill="white" font-size="13" font-weight="700" font-family="Inter, system-ui, sans-serif">ai-protocol-mock v0.1.7</text>

      <!-- Internal modules -->
      <rect x="788" y="418" width="120" height="35" rx="6" fill="#6b7280" opacity="0.1" stroke="#6b7280" stroke-width="0.5" />
      <text x="848" y="432" text-anchor="middle" fill="#9ca3af" font-size="10" font-weight="600" font-family="Inter, system-ui, sans-serif">{isZh ? '模拟服务器' : 'Mock Server'}</text>
      <text x="848" y="446" text-anchor="middle" fill="#64748b" font-size="8" font-family="Inter, system-ui, sans-serif">{isZh ? '本地测试' : 'Local Testing'}</text>

      <rect x="920" y="418" width="115" height="35" rx="6" fill="#6b7280" opacity="0.1" stroke="#6b7280" stroke-width="0.5" />
      <text x="977" y="432" text-anchor="middle" fill="#9ca3af" font-size="10" font-weight="600" font-family="Inter, system-ui, sans-serif">{isZh ? '响应录制' : 'Record/Replay'}</text>
      <text x="977" y="446" text-anchor="middle" fill="#64748b" font-size="8" font-family="Inter, system-ui, sans-serif">{isZh ? '快照测试' : 'Snapshot Tests'}</text>

      <rect x="788" y="463" width="247" height="28" rx="6" fill="#6b7280" opacity="0.1" stroke="#6b7280" stroke-width="0.5" />
      <text x="911" y="481" text-anchor="middle" fill="#9ca3af" font-size="10" font-weight="600" font-family="Inter, system-ui, sans-serif">{isZh ? '协议兼容性验证' : 'Protocol Compliance Check'}</text>

      <text x="910" y="490" text-anchor="middle" fill="#64748b" font-size="9" font-family="Inter, system-ui, sans-serif">{isZh ? '开发测试 · CI/CD · 无需真实 API' : 'Dev Testing · CI/CD · No real API needed'}</text>
    </g>

    <!-- Arrow from Protocol to Mock -->
    <line x1="740" y1="440" x2="770" y2="440" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)" />
    <text x="755" y="432" text-anchor="middle" fill="#475569" font-size="8" font-family="Inter, system-ui, sans-serif">{isZh ? '模拟' : 'mock'}</text>
  </svg>
</div>
